/*! WinCC Unified View-of-Things sourcesplc 3.0.7 WinCC Unified PC Runtime {%version%}, Copyright (C) Siemens AG 2023. All Rights Reserved. */
var Sources;(()=>{"use strict";var e={d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Source:()=>j});var n,s,r,i,a,o,c,l={};e.r(l),e.d(l,{clearInterval:()=>I,clearTimeout:()=>T,setInterval:()=>C,setTimeout:()=>v}),function(e){e[e.info=0]="info",e[e.warning=1]="warning",e[e.error=2]="error",e[e.disconnected=256]="disconnected",e[e.connected=257]="connected",e[e.trial=258]="trial",e[e.readonly=259]="readonly"}(n||(n={})),function(e){e.Tag="Tag",e.Graphic="Graphic",e.Screen="Screen"}(s||(s={})),function(e){e[e.Graphic=0]="Graphic",e[e.Text=1]="Text",e[e.Font=2]="Font"}(r||(r={}));class u{constructor(e){this.currentQuality=-1,this.symbolic="",this.refCount=0,this.symbolic=j.ensureSymbolicName(e),this.refCount=1,this.lastValue=void 0,this.writeValues=[]}get plcType(){return this.typeInfo?this.typeInfo.PLC:""}}!function(e){e[e.Disconnected=0]="Disconnected",e[e.Unauthorized=1]="Unauthorized",e[e.Application=2]="Application",e[e.Network=3]="Network",e[e.Busy=4]="Busy",e[e.Unknown=5]="Unknown"}(i||(i={}));class d extends Error{constructor(e,t){super(),this.Reason=e,this.Result=t||[]}}class h{static loadFile(e,t){return new Promise((function(n,s){const r=new XMLHttpRequest;r.open("GET",e,!0),t&&r.setRequestHeader("Content-type",t),r.onreadystatechange=function(){4==r.readyState&&200==r.status?n(r.responseText):4==r.readyState&&r.status>=300&&s()},r.onerror=function(){s()},r.send()}))}static loadFileRange(e,t,n,s){return new Promise((function(r,i){const a=new XMLHttpRequest;a.open("GET",e,!0),s&&a.setRequestHeader("Content-Type",s),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("Range","bytes="+t+"-"+n),a.onreadystatechange=function(){4==a.readyState&&(200==a.status||206==a.status?r({result:206==a.status,content:a.responseText}):i())},a.onerror=function(){i()},a.send()}))}static sendRaw(e){return new Promise((function(t,n){const s=new XMLHttpRequest,r=h.ApiServer?h.ApiServer+"/api/jsonrpc":"/api/jsonrpc";s.open("POST",r,!0),s.setRequestHeader("Content-type","application/json"),h.Token&&s.setRequestHeader("X-Auth-Token",h.Token),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){const e=JSON.parse(s.responseText),r=function(e){if(e){if(!Array.isArray(e))return e.error;{const t=e.find((e=>e.error));if(t)return t.error}}}(e);if(r){let t=!1;switch(r.code){case 2:case 100:n(new d(i.Unauthorized)),t=!0;break;case 3:case 4:n(new d(i.Busy)),t=!0;break;case-32602:case 205:n(new d(i.Application,function(e){return Array.isArray(e)?e:[e]}(e))),t=!0}if(t)return}t(e)}else s.status>=400&&n(new d(i.Network))},s.onerror=function(){n(new d(i.Network))},s.send(JSON.stringify(e))}))}static getId(){return this._msgId>=Number.MAX_SAFE_INTEGER&&(this._msgId=0),this._msgId++,this._msgId}static sendMessage(e,t){const n={jsonrpc:"2.0",method:e,id:this.getId()};return t&&(n.params=t),this.sendRaw(n)}static createMessage(e,t){const n={jsonrpc:"2.0",method:e,id:this.getId()};return t&&(n.params=t),n}}h.ApiServer=void 0,h._msgId=0,function(e){e.Tag="Tag",e.Graphic="Graphic",e.Screen="Screen"}(a||(a={}));class f{constructor(e){this._config=e}resolveById(e,t){const n=t?t.toString().toLowerCase()+"s":void 0,s=this._config;let r="";return Object.keys(s).forEach((function(t){r||n&&t!==n||s[t].forEach((function(t){!r&&f.matchId(t.id,e)&&(r=t.name)}))})),r}resolveByName(e,t){const n=t?t.toString().toLowerCase()+"s":void 0,s=this._config;let r;return Object.keys(s).forEach((function(t){r||n&&t!==n||s[t].forEach((function(t){r||t.name!=e||t.id&&(r=t.id)}))})),r}static matchId(e,t){let n=!0;return t.system&&e.system!=t.system&&(n=!1),t.object&&e.object!=t.object&&(n=!1),t.element&&e.element!=t.element&&(n=!1),n}}!function(e){e[e.Graphic=0]="Graphic",e[e.Text=1]="Text",e[e.Font=2]="Font"}(o||(o={}));class p{constructor(e){this._libraries=e}resolveGraphic(e,t){return this.resolve(o.Graphic,e,t)}resolveText(e,t){return this.resolve(o.Text,e,t)}resolveFontDescription(e,t){return this.resolve(o.Font,e,t)}resolve(e,t,n){let s="";if(this._libraries&&(0==t.system||!t.system)){let r=this._libraries.graphiclibrary;switch(e){case o.Text:r=this._libraries.textlibrary;break;case o.Font:r=this._libraries.fontlibrary}r.forEach((function(r){if(r.objectID===t.object){let i=r.graphics;switch(e){case o.Text:i=r.texts;break;case o.Font:i=r.fontdescriptions}i.forEach((function(r){if(r.elementID===t.element){let t=r.graphic;switch(e){case o.Text:t=r.text;break;case o.Font:t=r.fontdescription}s=t[n]?t[n]:""}}))}}))}return s}}!function(e){e[e.Unknown=0]="Unknown",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.Big=3]="Big",e[e.String=4]="String",e[e.DateTime=5]="DateTime",e[e.Time=6]="Time"}(c||(c={}));class g{constructor(e,t,n){this.CHROM=e,this.PLC=t,this.Internal=n}}class y{static getTypeInfo(e){if(!e||0===e.length)return new g("","",c.Unknown);switch(e=e.toLowerCase()){case"bool":return new g("Bool",e,c.Boolean);case"byte":return new g("Byte",e,c.Number);case"sint":return new g("SInt",e,c.Number);case"usint":return new g("USInt",e,c.Number);case"char":return new g("Char",e,c.String);case"wchar":return new g("WChar",e,c.String);case"word":return new g("Word",e,c.Number);case"int":return new g("Int",e,c.Number);case"uint":return new g("UInt",e,c.Number);case"dword":return new g("DWord",e,c.Number);case"dint":return new g("DInt",e,c.Number);case"udint":return new g("UDInt",e,c.Number);case"real":return new g("Real",e,c.Number);case"string":return new g("String",e,c.String);case"wstring":return new g("WString",e,c.String);case"lint":return new g("LInt",e,c.Big);case"ulint":return new g("ULInt",e,c.Big);case"lword":return new g("LWord",e,c.Big);case"lreal":return new g("LReal",e,c.Number);case"dt":case"ldt":case"date_and_time":case"date":return new g("DateTime",e,c.DateTime);case"time":case"ltime":case"s5time":case"ltod":case"tod":case"ltime_of_day":case"time_of_day":return new g("TimeSpan",e,c.Time);default:return new g(e,e,c.Unknown)}}static toCHROM(e,t){if(!t)return e;try{if(t.Internal==c.Big)return window.Big(e);if(t.Internal==c.DateTime){if("date"===t.PLC){const t=new Date(Date.UTC(1990,0,1)),n=1e3*e*60*60*24;return this.msToTuple(n+t.getTime())}if("date_and_time"===t.PLC){const t=new Date(Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second)).getTime();return this.msToTuple(t)}if("ldt"===t.PLC)return this.stringToTuple(e)}else if(t.Internal==c.Time){if("s5time"===t.PLC){const t=e.basis*e.value;return this.msToTuple(t)}if("time"===t.PLC||"time_of_day"===t.PLC)return this.msToTuple(e);if("ltime"===t.PLC||"ltime_of_day"===t.PLC)return this.stringToTuple(e)}}catch(e){}return e}static toPLC(e,t){if(!t)return e;try{if(t.Internal==c.Big)return"string"==typeof e?e:e.toString();if(t.Internal==c.DateTime){if("date"===t.PLC){const t=this.tupleToMs(e),n=new Date(Date.UTC(1990,0,1)),s=Math.floor((t-n.getTime())/864e5);return Math.max(s,0)}if("date_and_time"===t.PLC){const t=new Date(this.tupleToMs(e));return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds()}}if("ldt"===t.PLC)return this.tupleToString(e)}else if(t.Internal==c.Time){if("s5time"===t.PLC)return this.msToS5Time(this.tupleToMs(e));if("time"===t.PLC||"time_of_day"===t.PLC)return this.tupleToMs(e);if("ltime"===t.PLC||"ltime_of_day"===t.PLC)return this.tupleToString(e)}}catch(e){}return e}static tupleToMs(e){const t=1e6*e[0]+e[1]/1e3;return Math.round(t/1e3)}static msToTuple(e){const t=Math.ceil(e/1e3);return[t,1e6*(e-1e3*t)]}static stringToTuple(e){const t=window.Big(e),n=Math.ceil(t.div(1e9)),s=window.Big(n).mul(1e9);return[n,Number(t.sub(s))]}static tupleToString(e){return window.Big(e[0]).mul(1e9).add(e[1]).toString()}static msToS5Time(e){let t=0,n=!1;return 0==e||e>=10&&e<=9990?t=10:e>=100&&e<=99900?t=100:e>=1e3&&e<=999e3?t=1e3:e>=1e4&&e<=999e4?t=1e4:n=!0,n||e<=0?{basis:0,value:0}:{basis:t,value:Math.ceil(e/t)}}}const m=new Blob(["{\n    const fnIdRecorder = {};\n    const messageHandler = (ev) => {\n        if (!ev || !ev.data) { return false; }\n        const { api, fnId, countdown = 0 } = ev.data;\n        switch (api) {\n            case 'setTimeout':\n                fnIdRecorder[fnId] = self.setTimeout(() => {\n                    self.postMessage({ fnId: fnId });\n                    delete fnIdRecorder[fnId];\n                }, countdown);\n                break;\n\n            case 'setInterval':\n                fnIdRecorder[fnId] = self.setInterval(() => {\n                    self.postMessage({ fnId: fnId });\n                }, countdown);\n                break;\n\n            case 'clearTimeout':\n            case 'clearInterval':\n                if (fnId in fnIdRecorder) {\n                    self[api](fnIdRecorder[fnId]);\n                    delete fnIdRecorder[fnId];\n                }\n                break;\n\n            default:\n                try {\n                    throw new Error('Undefined reaction by anti-throttling.');\n                }\n                catch (err) {\n                    console.error(err);\n                    return false;\n                }\n                break;\n        }\n        return true;\n    };\n    self.addEventListener('message', messageHandler);\n}"],{type:"text/javascript"}),w=new Worker(URL.createObjectURL(m)),_=()=>{let e=1;for(;e in b;)e++,e>2147483647&&(e=1);return e},b={},v=(e,t,...n)=>{const s=_();return b[s]={callback:e,isTimeout:!0,params:n},w.postMessage({api:"setTimeout",fnId:s,countdown:t}),s},T=e=>e in b&&(delete b[e],w.postMessage({api:"clearTimeout",fnId:e}),!0),C=(e,t,...n)=>{const s=_();return b[s]={callback:e,params:n},w.postMessage({api:"setInterval",fnId:s,countdown:t}),s},I=e=>e in b&&(delete b[e],w.postMessage({api:"clearInterval",fnId:e}),!0);w.addEventListener("message",(e=>{if(!e||!e.data)return!1;const t=e.data.fnId||"";if(!t||!(t in b))return!1;const{callback:n,isTimeout:s=!1,params:r}=b[t];return s&&delete b[t],"function"==typeof n&&n.apply(self,r),!0}));class S{constructor(e,t=null,n=-1,s=-1){this.typeInfo=e,this.value=t,this.currentQuality=n,this.timestamp=s}get type(){return this.typeInfo?this.typeInfo.CHROM:""}get plc(){return this.typeInfo?this.typeInfo.PLC:""}}var M;!function(e){e[e.Unknown=0]="Unknown",e[e.Unavailable=1]="Unavailable",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Available=4]="Available"}(M||(M={}));class j{constructor(e){this._state=M.Unknown,this._timerId=-1,this._keepaliveTimer=-1,this._inCycle=!1,this._supportsRanges=!1,this._pendingReads=[],this._pendingWrites=[],this._decoder=new TextDecoder("utf8"),h.Token=e,this._ready=this.Initialize()}async sendAndCheckMessage(e,t){try{const t=await h.sendRaw(e);return this._state===M.Disconnected&&this.changeState(M.Connected),{success:!0,result:t}}catch(e){if(e instanceof d)if(e.Reason===i.Unauthorized)t&&this._state!==M.Disconnected?this.notify(n.error,"Write access not authorized"):(this.changeState(M.Connected),this.notify(n.error,"Re-Authentication needed."),v((function(){location.reload()}),3e3));else if(e.Reason===i.Application){if(t&&this._state!==M.Disconnected)return{success:!1,result:e.Result}}else this.changeState(M.Disconnected)}return{success:!1}}changeState(e){switch(this._state=e,e){case M.Connected:this._state,M.Unknown,this.notify(n.connected,"Connected to PLC");break;case M.Disconnected:this.notify(n.disconnected,"Disconnected from PLC");case M.Available:case M.Unavailable:}}async Initialize(){const e=await h.sendMessage("Api.GetPermissions");if(e&&e.result&&Array.isArray(e.result)&&e.result.length>0){let t=!1;if(e.result.forEach((function(e){"read_value"==e.name&&(t=!0)})),t){try{const e=await h.loadFileRange("project.json",0,1,"application/json");this._supportsRanges=e.result,!e.result&&e.content&&e.content.length>1&&(this._project=JSON.parse(e.content))}catch(e){this._supportsRanges=!1}try{!this._supportsRanges&&this._project||(this._project=JSON.parse(await h.loadFile("project.json","application/json"))),this.Names=new f(this._project.names),this.Libraries=new p({graphiclibrary:this._project.graphiclibrary,textlibrary:this._project.textlibrary,fontlibrary:this._project.fontlibrary}),this.TimerService=l}catch(e){return this.changeState(M.Unavailable),!1}}return this.changeState(t?M.Available:M.Unavailable),t}return!1}setNotificationService(e){this._notifyService=e,this.notify(n.info,"NotificationService registered")}notify(e,t){this._notifyService&&this._notifyService.log(e,"Source",t)}async getSettings(){await this._ready;return{startLanguage:this._project.start.language,startStyleName:this._project.start.style,startScreenName:this._project.start.screen,fonts:this._project.fonts}}async loadScreen(e){var t,n;await this._ready;let s=-1;if("string"==typeof e){const n=null===(t=this.Names)||void 0===t?void 0:t.resolveByName(e,a.Screen);n&&n.object&&(s=n.object)}else"object"==typeof e&&e.object&&(s=e.object);let r=null;if(s>=0)try{r=await h.loadFile("screens/screen_"+s+".json","application/json")}catch(e){}if(!r){let t;if(t="string"==typeof e?e:null===(n=this.Names)||void 0===n?void 0:n.resolveById(e,a.Screen),r=await h.loadFile("screens/"+t+".json","application/json"),!r)throw"Screen not found"}return JSON.parse(r)}async loadStyle(e){return await this._ready,JSON.parse(await h.loadFile("styles/"+e+".json","application/json"))}setTagCallback(e){this._tagCallback=e,this._ensureCycle()}_invokeCallback(e){if(this._tagCallback)try{this._tagCallback(e)}catch(e){this.notify(n.error,`tagCallback throws ${e}`)}}async getTypes(e){var t;const n=new Array,s=new Map,r=new Map;if(e.forEach((function(e){const t=j.ensureSymbolicName(e);if(j._types.has(t)){const n=j._types.get(t);r.set(e,{type:null==n?void 0:n.CHROM,currentQuality:4})}else{const r=h.createMessage("PlcProgram.Browse",{var:t,mode:"var"});n.push(r),s.set(r.id,e)}})),n.length>0){const e=null===(t=await this.sendAndCheckMessage(n))||void 0===t?void 0:t.result;e&&Array.isArray(e)&&e.length>0?e.forEach((function(e){if(e&&e.id&&s.has(e.id)){const t=s.get(e.id);if(t)if(e.result&&Array.isArray(e.result)){const n=y.getTypeInfo(e.result[0].datatype),s=j.ensureSymbolicName(t);j._types.set(s,n),r.set(t,{type:n.CHROM,currentQuality:4})}else r.set(t,{currentQuality:1})}})):n.forEach((function(e){const t=s.get(e.id);r.set(t,{currentQuality:1})}))}return r}_doNextWrite(){const e=this._pendingWrites[0];e&&e().then((()=>{this._pendingWrites.shift(),this._doNextWrite()}))}async writeValues(e){const t=new Promise((t=>{this._pendingWrites.push((()=>this._writeValues(e).then((()=>{t()}))))}));return 1===this._pendingWrites.length&&this._doNextWrite(),t}async _writeValues(e){var t;const s=new Array,r=new Map;if(e.forEach((function(e,t){const n=j.ensureSymbolicName(t);if(!j._types.has(n)){const e=h.createMessage("PlcProgram.Browse",{var:n,mode:"var"});s.push(e),r.set(e.id,t)}})),s.length>0){const e=null===(t=await this.sendAndCheckMessage(s))||void 0===t?void 0:t.result;e&&Array.isArray(e)&&e.length>0&&e.forEach((function(e){if(e&&e.id&&r.has(e.id)&&e.result&&Array.isArray(e.result)){const t=r.get(e.id);if(t){const n=y.getTypeInfo(e.result[0].datatype),s=j.ensureSymbolicName(t);j._types.set(s,n)}}}))}if(e&&e.size>0){const t=new Array;e.forEach((function(e,n){const s=j.ensureSymbolicName(n),i=j._types.get(s),a=i?y.toPLC(e,i):e,o=h.createMessage("PlcProgram.Write",{var:s,value:a});r.set(o.id,n),t.push(o);const c=j._subscriptions.get(n);c&&c.writeValues.push(a)}));const s=await this.sendAndCheckMessage(t,!0);if(!s.success){const e=s.result;if(e&&Array.isArray(e)&&e.length>0){const t=new Map,s=Date.now();e.forEach((e=>{if(e&&e.error&&e.id&&r.has(e.id)){const i=r.get(e.id);if(i){this.notify(n.warning,`Write tag ${i} failed: ${e.error.message}`);const r=j._subscriptions.get(i);if(r&&(r.writeValues.length=0,r.currentQuality>=0&&!t.has(i))){const e=this._state!==M.Disconnected?r.currentQuality:1,n=new S(r.typeInfo,y.toCHROM(r.lastValue,r.typeInfo),e,s);t.set(i,n)}}}})),t.size&&this._invokeCallback(t)}}}}static ensureSymbolicName(e){let t=e;const n=this.splitSymbolicName(e);if(n&&n.length>0){if(t="",1===n.length){let e=n[0];const t=e.indexOf("[");if(t>0){let n=e.substr(0,t);return'"'===n[0]&&'"'===n[n.length-1]||(n='"'+n+'"',e=n+e.substr(t)),e}return'"'!==e[0]||'"'!==e[e.length-1]?'"'+e+'"':e}for(let e=0;e<n.length;e++){let s=n[e];const r=s.indexOf("[");if(r>0){let t=s.substr(0,r);e==n.length-1||'"'===t[0]&&'"'===s[t.length-1]||(t='"'+t+'"',s=t+s.substr(r))}else e==n.length-1||'"'===s[0]&&'"'===s[s.length-1]||(s='"'+s+'"');t=t+(0!=e?".":"")+s}}return t}static splitSymbolicName(e){const t=new Array;let n=!0,s=e;for(;n;){const e=s.match(/\.(?=([^"]*"[^"]*")*[^"]*$)/);e&&e.index&&e.index>0?(t.push(s.substr(0,e.index)),s=s.substr(e.index+1)):(n=!1,t.push(s))}return t}async logout(e){await h.sendMessage("Api.Logout"),e&&await e(),location.reload()}_doNextRead(){const e=this._pendingReads[0];e&&e().then((()=>{this._pendingReads.shift(),this._doNextRead()}))}async readValues(e){const t=new Promise((t=>{this._pendingReads.push((()=>this._readValues(e).then((e=>{t(e)}))))}));return 1===this._pendingReads.length&&this._doNextRead(),t}async _readValues(e){var t,n;const s=new Array,r=new Array,i=new Map,a=new Map,o=new Map;if(e.forEach((function(e){const t=j.ensureSymbolicName(e);if(j._types.has(t)){const n=j._types.get(t);a.set(e,new S(n));const s=h.createMessage("PlcProgram.Read",{var:t});r.push(s),i.set(s.id,e)}else{const n=h.createMessage("PlcProgram.Browse",{var:t,mode:"var"});s.push(n),i.set(n.id,e)}})),s.length>0){const e=Date.now(),n=null===(t=await this.sendAndCheckMessage(s))||void 0===t?void 0:t.result;n&&Array.isArray(n)&&n.length>0?n.forEach((function(e){if(e&&e.id&&i.has(e.id)&&e.result&&Array.isArray(e.result)){const t=i.get(e.id);if(t){const n=y.getTypeInfo(e.result[0].datatype),s=new S(n);s.currentQuality=1,a.set(t,s);const o=j.ensureSymbolicName(t),c=h.createMessage("PlcProgram.Read",{var:o});r.push(c),i.set(c.id,t),j._types.set(o,n)}}})):s.forEach((function(t){const n=i.get(t.id),s=a.get(n);s&&(s.timestamp=e,o.set(n,s))}))}if(r.length>0){const e=Date.now(),t=null===(n=await this.sendAndCheckMessage(r))||void 0===n?void 0:n.result;t&&Array.isArray(t)&&t.length>0?t.forEach((function(t){if(t&&t.id&&i.has(t.id)){const n=i.get(t.id),s=a.get(n);n&&s&&(void 0!==t.result?(s.value=y.toCHROM(t.result,s.typeInfo),s.currentQuality=4,s.timestamp=e,o.set(n,s)):(s.timestamp=e,o.set(n,s)))}})):r.forEach((function(t){const n=i.get(t.id),s=a.get(n);s&&(s.timestamp=e,o.set(n,s))}))}return o}async keepalive(){const e=h.createMessage("Api.Ping");await this.sendAndCheckMessage(e)}setSubscriptions(e){const t=j._subscriptions;e.forEach((function(e){const n=t.get(e);n?n.refCount++:t.set(e,new u(e))})),this._ensureCycle()}removeSubscriptions(e){const t=j._subscriptions;e.forEach((function(e){if(t.has(e)){const n=t.get(e);n&&(n.refCount--,0==n.refCount&&t.delete(e))}})),this._ensureCycle()}_ensureCycle(){const e=j._subscriptions.size>0&&this._tagCallback,t=this._timerId>=0;t&&!e?(I(this._timerId),this._timerId=-1,this._keepaliveTimer=C((()=>this.keepalive()),3e4)):!t&&e?(this._timerId=C(this._appCycle.bind(this),this._project&&this._project.app&&this._project.app.cycle?this._project.app.cycle:1e3),I(this._keepaliveTimer),this._keepaliveTimer=-1):t||e||-1!==this._keepaliveTimer||(this._keepaliveTimer=C((()=>this.keepalive()),3e4))}_isEqual(e,t){if(e===t)return!0;if("object"!=typeof e||null===e)return!1;if("object"!=typeof t||null===t)return!1;const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const s of n)if(e[s]!==t[s])return!1;return!0}async _appCycle(){var e,t;if(this._inCycle)return void this.notify(n.warning,"appCycle called while in cycle.");this._inCycle=!0;const s=j._subscriptions,r=new Array,i=new Array,a=new Map;s.forEach((function(e,t){if(!e.plcType&&e.currentQuality<0){const n=h.createMessage("PlcProgram.Browse",{var:e.symbolic,mode:"var"});r.push(n),a.set(n.id,t)}else if(e.plcType){const n=h.createMessage("PlcProgram.Read",{var:e.symbolic});i.push(n),a.set(n.id,t)}}));const o=new Map;if(r.length>0){const t=null===(e=await this.sendAndCheckMessage(r))||void 0===e?void 0:e.result;t&&Array.isArray(t)&&t.length>0?t.forEach((function(e){if(e&&e.id&&a.has(e.id)){const t=a.get(e.id),n=s.get(t);if(t&&n)if(e.result&&Array.isArray(e.result)){const s=y.getTypeInfo(e.result[0].datatype);n.typeInfo=s,n.currentQuality=4,j._types.set(n.symbolic,s);const r=h.createMessage("PlcProgram.Read",{var:n.symbolic});i.push(r),a.set(r.id,t)}else n.currentQuality=1,o.set(t,{currentQuality:1})}})):r.forEach((function(e){const t=a.get(e.id);o.set(t,{currentQuality:1})}))}if(i.length>0){const e=Date.now(),n=null===(t=await this.sendAndCheckMessage(i))||void 0===t?void 0:t.result,r=o;n&&Array.isArray(n)&&n.length>0?n.forEach((t=>{if(t&&t.id&&a.has(t.id)){const n=a.get(t.id),i=s.get(n);if(n&&i){if(void 0!==t.result)if(this._isEqual(t.result,i.lastValue)){if(i.writeValues.length>0&&void 0!==i.writeValues.find((e=>!this._isEqual(t.result,e)))){const s=new S(i.typeInfo,y.toCHROM(t.result,i.typeInfo),4,e);r.set(n,s)}}else{i.lastValue=t.result;const s=new S(i.typeInfo,y.toCHROM(t.result,i.typeInfo),4,e);r.set(n,s)}else r.set(n,{currentQuality:1});i.writeValues.length=0}}})):i.forEach((function(e){const t=a.get(e.id);r.set(t,{currentQuality:1})})),r.size>0&&this._invokeCallback(r)}else o.size>0&&this._invokeCallback(o);this._inCycle=!1}async getRangeFromMap(e,t,n,s){if(!j._rangeFiles.has(e)){const t=new Promise((async function(t){const n=await h.loadFile(e,s);j._rangeFiles.set(e,j._encoder.encode(n)),t()}));j._rangeFiles.set(e,t)}if(j._rangeFiles.has(e)){let s=j._rangeFiles.get(e);if(s instanceof Promise&&(await s,s=j._rangeFiles.get(e)),s instanceof Uint8Array&&s.length>=n)return this._decoder.decode(s.subarray(t,n))}return""}async getFileRange(e,t){if(e&&e.startsWith("range:")){const n=e.indexOf(";"),s=e.substring(6,n);let r,i=e.indexOf(";",n+7);i<=0?i=e.length:r=e.substr(i+1);const a=e.substring(n+7,i).split("-"),o=parseInt(a[0]),c=parseInt(a[1]),l=this._supportsRanges?(await h.loadFileRange(s,o,c,r)).content:await this.getRangeFromMap(s,o,c,r);return t&&r?`data:${r},${window.btoa(l)}`:l}throw"No uri requested"}getCycle(e){if(this._project.cycles&&Array.isArray(this._project.cycles))for(let t=0;t<this._project.cycles.length;t++)if(this._project.cycles[t].objectID==e.object)return this._project.cycles[t];return null}getWidget(e){if(this._project.widgets&&Array.isArray(this._project.widgets))for(let t=0;t<this._project.widgets.length;t++)if(this._project.widgets[t].id.object==e.object)return this._project.widgets[t].resource;return null}}j.Connectivity=h,j._subscriptions=new Map,j._types=new Map,j._rangeFiles=new Map,j._encoder=new TextEncoder,Sources=t})();